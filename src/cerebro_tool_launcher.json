[{"id":"cerebro_tool_launcher","user_id":"5c81c4d9-7456-4fa6-b2cd-860cd3b13d61","name":"Cerebro Tool Launcher","type":"filter","content":"\"\"\"\ntitle: Cerebro Tool Launcher\nauthor: Andrew Tait Gehrhardt\nauthor_url: https://github.com/atgehrhardt/Cerebro-OpenWebUI-Package-Manager\nfunding_url: https://github.com/open-webui\nversion: 0.1.0\n\"\"\"\n\nfrom typing import List, Dict, Optional\nimport re\nimport uuid\nfrom apps.webui.models.files import Files\nimport requests\n\n\nclass Filter:\n    def __init__(self):\n        self.file = None\n        self.user_id = None\n\n    def inlet(self, body: dict, __user__: Optional[dict] = None) -> dict:\n        print(f\"inlet:{__name__}\")\n        print(f\"inlet:body:{body}\")\n        print(f\"inlet:user:{__user__}\")\n        if __user__ and \"id\" in __user__:\n            self.user_id = __user__[\"id\"]\n        else:\n            print(\"Warning: No valid user ID provided\")\n        return body\n\n    def handle_package(self, package_name: str):\n        files = Files.get_files()\n        files = [file for file in files if file.user_id == self.user_id]\n        files = [\n            file\n            for file in files\n            if file.filename.endswith(f\"{package_name}_capp.html\")\n        ]\n        print(\"Files: \", files)\n        if files:\n            self.file = files[0].id\n            print(f\"\\nFound file: {self.file}\\n\")\n            return True\n        else:\n            print(f\"No matching file found for package: {package_name}\")\n            return False\n\n    def outlet(self, body: dict, __user__: Optional[dict] = None) -> dict:\n        print(f\"outlet:{__name__}\")\n        print(f\"outlet:body:{body}\")\n        print(f\"outlet:user:{__user__}\")\n        messages = body.get(\"messages\", [])\n        if messages:\n            last_message = messages[-1][\"content\"]\n            owui_run_matches = re.finditer(r\"owui run (\\w+)\", last_message)\n\n            new_content = last_message\n            for match in owui_run_matches:\n                package_name = match.group(1)\n                print(f\"Detected 'owui run' command for package: {package_name}\")\n                if self.handle_package(package_name):\n                    if self.file:\n                        replacement = f\"{{{{HTML_FILE_ID_{self.file}}}}}\"\n                        new_content = new_content.replace(match.group(0), replacement)\n                        self.file = None  # Reset file ID after use\n                    else:\n                        print(\n                            f\"Error: File ID not set after handling package {package_name}\"\n                        )\n                        replacement = f\"Error: Unable to load package {package_name}\"\n                        new_content = new_content.replace(match.group(0), replacement)\n                else:\n                    print(f\"Error: Failed to handle package {package_name}\")\n                    replacement = f\"Error: Failed to load package {package_name}\"\n                    new_content = new_content.replace(match.group(0), replacement)\n\n            messages[-1][\"content\"] = new_content\n        return body\n","meta":{"description":"Cerebro Tool Launcher","manifest":{"title":"Cerebro Tool Launcher","author":"Andrew Tait Gehrhardt","author_url":"https://github.com/atgehrhardt/Cerebro-OpenWebUI-Package-Manager","funding_url":"https://github.com/open-webui","version":"0.1.0"}},"is_active":true,"updated_at":1719468485,"created_at":1719468474}]